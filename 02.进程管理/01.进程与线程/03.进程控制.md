# 第三节、进程控制

## 目录

- **为什么**要进行进程控制？
- **什么**是进程控制？
- **怎样**进行进程控制？
- 进程控制**相关的原语**

## 一、为什么要进行进程控制？

    为了实现进程状态的切换。
    （为什么进程状态要切换？ -> 为了程序能够并发执行啊啊啊啊）

## 二、什么是进程控制？

    管理系统中的所有进程，包括创建新进程、撤销已有进程、实现进程状态转换等。

## 三、怎样进行进程控制？

通过**原语**实现进程控制，因为原语具有原子性，即不允许中断，这样进程控制中的种种错误就可以避免。**原语能管理进程，所以必定是只能在核心态下执行的特权指令**。

> 【注意】：
>
> 用 **关中断** 和 **开中断** 这两个特权指令实现了原语的原子性。

## 四、进程控制**相关的原语**

- 进程的创建
- 进程的终止
- 进程的阻塞和唤醒
- 进程切换

#### 1. 进程的创建

- 创建过程
- 引起进程创建的事件

##### 1.1 进程的创建过程

    Step1：分配进程标识号，申请空白PCB
    ||
    ||
    ||
    Step2：为进程分配资源
    ||
    ||
    ||
    Step3：初始化PCB
    ||
    ||
    ||
    Step4：若进程就绪队列可接纳新进程，则将新进程插入就绪队列

> 【注意】：
>
> 1. **Step1**中若 PCB**申请失败**，则**创建失败**。
> 2. **Step2**中若资源不足（如内存不够），则**并不是创建失败**，而是处于阻塞状态，等待内存资源。
> 3. **Step3**初始化 PCB 主要指的是：**初始化标志信息**、**初始化处理机状态信息**、**初始化出处理机控制信息**以及**设置进程的优先级**等。

---

##### 1.2 引起进程创建的事件

    事件1：终端用户登录系统
    事件2：作业调度
    事件3：系统提供服务
    事件4：用户程序的应用请求

---

#### 2. 进程的终止

- 终止过程
- 引起进程创建的事件

##### 2.1 进程的终止过程

    Step1：根据被终止进程的标识符，检索PCB，从中读出该进程的状态
    ||
    ||
    ||
    Step2：若被终止状态处于执行状态，立即终止该进程，将处理机资源分配给别的进程
    ||
    ||
    ||
    Step3：若该进程还有子孙进程，也应将其子孙进程终止
    ||
    ||
    ||
    Step4：将该进程所拥有的全部资源，或归还父进程，或归还OS
    ||
    ||
    ||
    Step5：将改PCB从所在队列（链表）中删除

---

##### 2.2 引起进程终止的事件

> 1. 进程**正常**结束
> 2. 进程**异常**结束
>    > 例如，存储区越界、保护错、非法指令、特权指令错、运行超时、算数运算错、I/O 故障等。
> 3. **外界干预**
>    > 例如，操作员或操作系统干预、父进程请求和父进程终止。

---

#### 3. 进程的阻塞和唤醒

- 进程的阻塞过程
- 引起进程阻塞的事件

---

- 进程的唤醒过程
- 引起进程唤醒的事件

##### 3.1 进程的阻塞过程

    Step1：找到将要被阻塞的进程标识号对应的PCB
    ||
    ||
    ||
    Step2：若该进程处于运行态，则保护其现场，变为阻塞态，停止运行
    ||
    ||
    ||
    Step3：把PCB插入相应事件的等待队列，将处理机资源给其他就绪进程

---

##### 3.2 引起进程阻塞的事件

执行过程中，由于期待的某些事件未发生（如请求系统资源失败、等待某种操作的完成、新数据尚未到达或者无新工作可做等），由**系统自动执行阻塞原语**（Block），是自己由**由运行态变为阻塞态。**

---

##### 3.3 进程的唤醒过程

    Step1：找到将要被阻塞的进程标识号对应的PCB
    ||
    ||
    ||
    Step2：若该进程处于运行态，则保护其现场，变为阻塞态，停止运行
    ||
    ||
    ||
    Step3：把PCB插入相应事件的等待队列，将处理机资源给其他就绪进程

---

##### 3.2 引起进程唤醒的事件

执行过程中，由于期待的某些事件未发生（如请求系统资源失败、等待某种操作的完成、新数据尚未到达或者无新工作可做等），由**系统自动执行阻塞原语**（Block），是自己由\***\*由运行态变为阻塞态。**

---
